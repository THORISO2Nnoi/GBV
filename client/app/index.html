<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GBV Support & Safety App</title>
    <style>
        :root {
            --primary: #8B008B;
            --secondary: #4B0082;
            --accent: #FF69B4;
            --light: #F8F8FF;
            --dark: #2F2F2F;
            --safe: #32CD32;
            --warning: #FF4500;
            --danger: #DC143C;
            --app-bg: #f5f5f7;
            --card-bg: #ffffff;
            --success: #28a745;
            --info: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        .app-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .screen {
            display: none;
            flex-direction: column;
            height: 100vh;
        }

        .screen.active {
            display: flex;
        }

        /* Login & Register Styles */
        .login-container {
            padding: 2rem;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .logo {
            margin-bottom: 2rem;
        }

        .logo-icon {
            font-size: 3rem;
            display: block;
            margin-bottom: 1rem;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        input, select, textarea {
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 0, 139, 0.4);
        }

        /* App Header */
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        #logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
        }

        /* App Content */
        .app-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: var(--app-bg);
        }

        .screen-content {
            flex: 1;
            overflow-y: auto;
            background: var(--app-bg);
        }

        .emergency-btn {
            background: linear-gradient(135deg, var(--danger), var(--warning));
            color: white;
            border: none;
            border-radius: 50px;
            padding: 1.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            margin-bottom: 2rem;
        }

        .emergency-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(220, 20, 60, 0.6);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .action-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 1px solid #f0f0f0;
        }

        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .action-icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .recent-alerts {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .recent-alerts h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .fake-mode {
            text-align: center;
            margin-top: 2rem;
        }

        #fake-mode-btn {
            background: var(--safe);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        #fake-mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(50, 205, 50, 0.4);
        }

        /* Navigation */
        .app-nav {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 0.8rem 0;
            border-top: 1px solid #eee;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.8rem;
            color: #666;
            cursor: pointer;
            transition: color 0.3s;
            padding: 0.5rem;
            border-radius: 8px;
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(139, 0, 139, 0.1);
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }

        /* Emergency Screen */
        .emergency-container {
            padding: 2rem;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }

        .countdown {
            font-size: 4rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .emergency-actions {
            display: flex;
            gap: 1rem;
            margin: 2rem 0;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: var(--dark);
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
            font-weight: bold;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
            font-weight: bold;
        }

        .location-info, .contacts-list {
            background: rgba(255,255,255,0.9);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        /* Screen Header */
        .screen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: white;
            border-bottom: 1px solid #eee;
        }

        .screen-header h2 {
            color: var(--primary);
        }

        /* Contacts Screen */
        .contacts-list {
            background: white;
            border-radius: 0;
            margin: 0;
        }

        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            background: white;
        }

        .contact-item:hover {
            background: #f9f9f9;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }

        .contact-details {
            color: #666;
            font-size: 0.9rem;
        }

        .contact-relationship {
            color: var(--primary);
            font-size: 0.8rem;
            margin-top: 0.2rem;
        }

        /* Safety Plan Screen */
        .safety-plan-content {
            padding: 1.5rem;
        }

        .plan-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .plan-section h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .safe-locations {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .location-card {
            background: var(--light);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .location-card h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .protocol-steps {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .step-number {
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .emergency-numbers {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .number-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .number-card:hover {
            background: #e8e8ff;
            transform: translateX(5px);
        }

        .number-icon {
            font-size: 1.5rem;
        }

        /* Resources Screen */
        .resources-content {
            padding: 1.5rem;
        }

        .resource-section {
            margin-bottom: 2rem;
        }

        .resource-section h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .resource-cards {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .resource-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .resource-card.emergency {
            border-left: 4px solid var(--danger);
        }

        .resource-icon {
            font-size: 2rem;
        }

        .resource-card div {
            flex: 1;
        }

        .resource-card h4 {
            color: var(--dark);
            margin-bottom: 0.3rem;
        }

        .resource-card p {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.2rem;
        }

        .resource-card small {
            color: #666;
            font-size: 0.8rem;
        }

        .info-cards {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .info-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid var(--info);
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .info-card h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        /* Evidence Vault Screen */
        .evidence-content {
            padding: 1.5rem;
        }

        .evidence-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            flex: 1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .evidence-list {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            min-height: 200px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .security-notice {
            background: var(--light);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-left: 4px solid var(--safe);
        }

        .security-icon {
            font-size: 1.5rem;
        }

        /* Safe Chat Screen */
        .chat-content {
            padding: 1.5rem;
        }

        .chat-welcome {
            text-align: center;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chat-icon {
            font-size: 3rem;
            display: block;
            margin-bottom: 1rem;
        }

        .chat-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 2rem 0;
        }

        .chat-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: var(--light);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid var(--primary);
        }

        .chat-option:hover {
            background: #e8e8ff;
            transform: translateX(5px);
        }

        .option-icon {
            font-size: 2rem;
        }

        .chat-option h4 {
            color: var(--primary);
            margin-bottom: 0.3rem;
        }

        .chat-features {
            text-align: left;
            margin-top: 2rem;
        }

        .chat-features h4 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .chat-features ul {
            list-style: none;
            padding: 0;
        }

        .chat-features li {
            padding: 0.5rem 0;
            color: #666;
        }

        /* Profile Screen */
        .profile-content {
            padding: 1.5rem;
        }

        .profile-header {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 1rem;
        }

        .profile-info h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .profile-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .profile-stat {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            flex: 1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 0.8rem;
        }

        .profile-settings, .emergency-settings {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .profile-settings h3, .emergency-settings h3 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-item:hover {
            color: var(--primary);
            transform: translateX(5px);
        }

        .setting-icon {
            font-size: 1.2rem;
            width: 24px;
        }

        .setting-arrow {
            color: #ccc;
            font-size: 1.2rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: var(--primary);
            background: var(--light);
        }

        .upload-icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: #666;
        }

        .empty-icon {
            font-size: 3rem;
            display: block;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Alert Styles */
        .alert-item {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid var(--warning);
        }

        .alert-item.resolved {
            border-left-color: var(--safe);
        }

        .alert-time {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .alert-status {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-active {
            background: #fff3cd;
            color: #856404;
        }

        .status-resolved {
            background: #d4edda;
            color: #155724;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }

        /* Responsive Design */
        @media (max-width: 480px) {
            .app-container {
                max-width: 100%;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .emergency-actions {
                flex-direction: column;
            }
            
            .profile-stats {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Login Screen -->
        <div id="login-screen" class="screen active">
            <div class="login-container">
                <div class="logo">
                    <span class="logo-icon">üõ°Ô∏è</span>
                    <h1>Safety Shield</h1>
                </div>
                <form id="login-form" onsubmit="handleLogin(event)">
                    <h2>Welcome Back</h2>
                    <input type="email" id="login-email" placeholder="Email" required>
                    <input type="password" id="login-password" placeholder="Password" required>
                    <button type="submit" class="btn-primary">Sign In</button>
                </form>
                <p>Don't have an account? <a href="#" id="show-register">Sign Up</a></p>
            </div>
        </div>

        <!-- Register Screen -->
        <div id="register-screen" class="screen">
            <div class="login-container">
                <div class="logo">
                    <span class="logo-icon">üõ°Ô∏è</span>
                    <h1>Create Account</h1>
                </div>
                <form id="register-form">
                    <input type="text" id="register-name" placeholder="Full Name" required>
                    <input type="email" id="register-email" placeholder="Email" required>
                    <input type="password" id="register-password" placeholder="Password" required>
                    <input type="tel" id="register-phone" placeholder="Phone Number" required>
                    <button type="submit" class="btn-primary">Create Account</button>
                </form>
                <p>Already have an account? <a href="#" id="show-login">Sign In</a></p>
            </div>
        </div>

        <!-- Main App Screen -->
        <div id="app-screen" class="screen">
            <header class="app-header">
                <h2>Safety Shield</h2>
                <div class="user-menu">
                    <span id="user-name">User</span>
                    <button id="logout-btn">Logout</button>
                </div>
            </header>

            <div class="app-content">
                <!-- Emergency Button -->
                <button class="emergency-btn" id="emergency-btn">
                    <span class="btn-icon">üö®</span>
                    EMERGENCY HELP
                </button>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <div class="action-card" data-action="contacts">
                        <span class="action-icon">üë•</span>
                        <span>Trusted Contacts</span>
                    </div>
                    <div class="action-card" data-action="safety-plan">
                        <span class="action-icon">üõ°Ô∏è</span>
                        <span>Safety Plan</span>
                    </div>
                    <div class="action-card" data-action="resources">
                        <span class="action-icon">üìö</span>
                        <span>Resources</span>
                    </div>
                    <div class="action-card" data-action="evidence">
                        <span class="action-icon">üìÅ</span>
                        <span>Evidence Vault</span>
                    </div>
                </div>

                <!-- Recent Alerts -->
                <div class="recent-alerts" id="recent-alerts">
                    <h3>Recent Activity</h3>
                    <div id="alerts-list"></div>
                </div>

                <!-- Fake Mode Toggle -->
                <div class="fake-mode">
                    <button id="fake-mode-btn">Activate Calendar Mode</button>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="app-nav">
                <div class="nav-item active" data-screen="app">
                    <span class="nav-icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" data-screen="chat">
                    <span class="nav-icon">üí¨</span>
                    <span>Safe Chat</span>
                </div>
                <div class="nav-item" data-screen="contacts">
                    <span class="nav-icon">üë•</span>
                    <span>Contacts</span>
                </div>
                <div class="nav-item" data-screen="profile">
                    <span class="nav-icon">üë§</span>
                    <span>Profile</span>
                </div>
            </nav>
        </div>

        <!-- Emergency Screen -->
        <div id="emergency-screen" class="screen">
            <div class="emergency-container">
                <div class="countdown" id="countdown">5</div>
                <p id="help-message">Preparing to send help...</p>
                <p>Emergency alert will be sent in <span id="countdown-seconds">5</span> seconds</p>
                

                <div class="emergency-actions">
                    <button class="btn-secondary" id="cancel-emergency">I'm Safe</button>
                    <button class="btn-danger" id="send-now">Send Now</button>
                </div>

                <div class="location-info">
                    <h3>üìç Your Location</h3>
                    <p id="location-text">Getting your location...</p>
                </div>

                <div class="contacts-list">
                    <h3>Contacts to be notified:</h3>
                    <div id="emergency-contacts"></div>
                </div>
            </div>
        </div>

        <!-- Contacts Screen -->
        <div id="contacts-screen" class="screen">
            <div class="screen-header">
                <h2>Trusted Contacts</h2>
                <button class="btn-primary" id="add-contact-btn">Add Contact</button>
            </div>
            <div class="screen-content">
                <div class="contacts-list" id="contacts-list">
                    <div class="empty-state">
                        <span class="empty-icon">üë•</span>
                        <h3>No Trusted Contacts</h3>
                        <p>Add trusted contacts who will be notified in emergencies</p>
                    </div>
                </div>
            </div>
            <nav class="app-nav">
                <div class="nav-item" data-screen="app">
                    <span class="nav-icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" data-screen="chat">
                    <span class="nav-icon">üí¨</span>
                    <span>Safe Chat</span>
                </div>
                <div class="nav-item active" data-screen="contacts">
                    <span class="nav-icon">üë•</span>
                    <span>Contacts</span>
                </div>
                <div class="nav-item" data-screen="profile">
                    <span class="nav-icon">üë§</span>
                    <span>Profile</span>
                </div>
            </nav>
        </div>

        <!-- Safety Plan Screen -->
        <div id="safety-plan-screen" class="screen">
            <div class="screen-header">
                <h2>Safety Plan</h2>
            </div>
            <div class="screen-content">
                <div class="safety-plan-content">
                    <div class="plan-section">
                        <h3>üõ°Ô∏è Safe Locations</h3>
                        <div class="safe-locations" id="safe-locations">
                            <div class="location-card">
                                <h4>Home Safe Room</h4>
                                <p>Lockable room with emergency phone</p>
                            </div>
                            <div class="location-card">
                                <h4>Neighbor's House</h4>
                                <p>123 Safe Street - Always available</p>
                            </div>
                            <div class="location-card">
                                <h4>Local Shelter</h4>
                                <p>GBV Support Center - 24/7 access</p>
                            </div>
                        </div>
                        <button class="btn-secondary" onclick="addSafeLocation()">Add Safe Location</button>
                    </div>

                    <div class="plan-section">
                        <h3>üö® Emergency Protocol</h3>
                        <div class="protocol-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <p>Press EMERGENCY HELP button</p>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <p>Trusted contacts will be notified with your location</p>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <p>Move to nearest safe location if possible</p>
                            </div>
                            <div class="step">
                                <span class="step-number">4</span>
                                <p>Use safe word "BLUEBIRD" if speaking under duress</p>
                            </div>
                        </div>
                    </div>

                    <div class="plan-section">
                        <h3>üìû Emergency Numbers</h3>
                        <div class="emergency-numbers">
                            <div class="number-card" onclick="callNumber('911')">
                                <span class="number-icon">üöì</span>
                                <div>
                                    <h4>Police Emergency</h4>
                                    <p>911</p>
                                </div>
                            </div>
                            <div class="number-card" onclick="callNumber('0800428428')">
                                <span class="number-icon">üè•</span>
                                <div>
                                    <h4>GBV Helpline</h4>
                                    <p>0800 428 428</p>
                                </div>
                            </div>
                            <div class="number-card" onclick="callNumber('112')">
                                <span class="number-icon">üöë</span>
                                <div>
                                    <h4>Ambulance</h4>
                                    <p>112</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <nav class="app-nav">
                <div class="nav-item" data-screen="app">
                    <span class="nav-icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" data-screen="chat">
                    <span class="nav-icon">üí¨</span>
                    <span>Safe Chat</span>
                </div>
                <div class="nav-item" data-screen="contacts">
                    <span class="nav-icon">üë•</span>
                    <span>Contacts</span>
                </div>
                <div class="nav-item" data-screen="profile">
                    <span class="nav-icon">üë§</span>
                    <span>Profile</span>
                </div>
            </nav>
        </div>

        <!-- Resources Screen -->
        <div id="resources-screen" class="screen">
            <div class="screen-header">
                <h2>Resources & Help</h2>
            </div>
            <div class="screen-content">
                <div class="resources-content">
                    <div class="resource-section">
                        <h3>üìû Immediate Help</h3>
                        <div class="resource-cards">
                            <div class="resource-card emergency">
                                <span class="resource-icon">üö®</span>
                                <div>
                                    <h4>GBV Emergency Line</h4>
                                    <p>0800 428 428</p>
                                    <small>24/7 Free call</small>
                                </div>
                                <button class="btn-primary" onclick="callNumber('0800428428')">Call Now</button>
                            </div>
                            <div class="resource-card">
                                <span class="resource-icon">üè•</span>
                                <div>
                                    <h4>Lifeline Counseling</h4>
                                    <p>0861 322 322</p>
                                    <small>Suicide prevention</small>
                                </div>
                                <button class="btn-secondary" onclick="callNumber('0861322322')">Call</button>
                            </div>
                        </div>
                    </div>

                    <div class="resource-section">
                        <h3>üèõÔ∏è Local Services</h3>
                        <div class="resource-cards">
                            <div class="resource-card">
                                <span class="resource-icon">üè†</span>
                                <div>
                                    <h4>Safe Houses</h4>
                                    <p>5 shelters in your area</p>
                                    <small>24/7 protection</small>
                                </div>
                                <button class="btn-secondary" onclick="viewShelters()">View</button>
                            </div>
                            <div class="resource-card">
                                <span class="resource-icon">‚öñÔ∏è</span>
                                <div>
                                    <h4>Legal Aid</h4>
                                    <p>Free legal assistance</p>
                                    <small>Protection orders</small>
                                </div>
                                <button class="btn-secondary" onclick="viewLegalAid()">View</button>
                            </div>
                        </div>
                    </div>

                    <div class="resource-section">
                        <h3>üìö Educational Resources</h3>
                        <div class="info-cards">
                            <div class="info-card" onclick="openResource('safety-planning')">
                                <h4>Safety Planning Guide</h4>
                                <p>Step-by-step safety planning</p>
                            </div>
                            <div class="info-card" onclick="openResource('legal-rights')">
                                <h4>Know Your Rights</h4>
                                <p>Legal rights and protection orders</p>
                            </div>
                            <div class="info-card" onclick="openResource('counseling')">
                                <h4>Counseling Services</h4>
                                <p>Trauma support and therapy</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <nav class="app-nav">
                <div class="nav-item" data-screen="app">
                    <span class="nav-icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" data-screen="chat">
                    <span class="nav-icon">üí¨</span>
                    <span>Safe Chat</span>
                </div>
                <div class="nav-item" data-screen="contacts">
                    <span class="nav-icon">üë•</span>
                    <span>Contacts</span>
                </div>
                <div class="nav-item" data-screen="profile">
                    <span class="nav-icon">üë§</span>
                    <span>Profile</span>
                </div>
            </nav>
        </div>

       <!-- Evidence Vault Screen -->
<div id="evidence-screen" class="screen">
    <div class="screen-header">
        <h2>Evidence Vault</h2>
        <button class="btn-primary" id="add-evidence-btn">
            <span class="btn-icon">+</span>
            Add Evidence
        </button>
    </div>
    <div class="screen-content">
        <div class="evidence-content">
            <!-- Statistics Cards -->
            <div class="evidence-stats" id="evidence-stats">
                <div class="stat-card">
                    <span class="stat-number" id="total-evidence">0</span>
                    <span class="stat-label">Total Items</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="secure-storage">100%</span>
                    <span class="stat-label">Secure</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="recent-items">0</span>
                    <span class="stat-label">This Month</span>
                </div>
            </div>

            <!-- Filters and Search -->
            <div class="evidence-filters">
                <div class="filter-group">
                    <label for="evidence-type-filter">Filter by Type:</label>
                    <select id="evidence-type-filter">
                        <option value="all">All Types</option>
                        <option value="photo">Photos</option>
                        <option value="document">Documents</option>
                        <option value="audio">Audio</option>
                        <option value="video">Video</option>
                        <option value="note">Notes</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="evidence-sort">Sort by:</label>
                    <select id="evidence-sort">
                        <option value="incidentDate-desc">Most Recent Incident</option>
                        <option value="createdAt-desc">Newest Added</option>
                        <option value="title-asc">Title A-Z</option>
                    </select>
                </div>
                <div class="search-group">
                    <input type="text" id="evidence-search" placeholder="Search evidence...">
                    <button class="btn-secondary" id="search-btn">Search</button>
                </div>
            </div>

            <!-- Evidence List -->
            <div class="evidence-list-container">
                <div class="evidence-list-header">
                    <h3>Your Evidence</h3>
                    <div class="list-actions">
                        <button class="btn-secondary" id="export-btn">Export</button>
                        <button class="btn-secondary" id="refresh-btn">Refresh</button>
                    </div>
                </div>
                <div class="evidence-list" id="evidence-list">
                    <!-- Evidence items will be loaded here -->
                </div>
                <div class="pagination" id="evidence-pagination">
                    <!-- Pagination controls -->
                </div>
            </div>

            <!-- Security Notice -->
            <div class="security-notice">
                <span class="security-icon">üîí</span>
                <div>
                    <h4>Secure & Encrypted Storage</h4>
                    <p>All evidence is encrypted and stored securely. Only accessible with your authentication. Data is automatically backed up and protected.</p>
                </div>
            </div>
        </div>
    </div>
    <nav class="app-nav">
        <div class="nav-item" data-screen="app">
            <span class="nav-icon">üè†</span>
            <span>Home</span>
        </div>
        <div class="nav-item" data-screen="chat">
            <span class="nav-icon">üí¨</span>
            <span>Safe Chat</span>
        </div>
        <div class="nav-item" data-screen="contacts">
            <span class="nav-icon">üë•</span>
            <span>Contacts</span>
        </div>
        <div class="nav-item active" data-screen="evidence">
            <span class="nav-icon">üìÅ</span>
            <span>Evidence</span>
        </div>
    </nav>
</div>

<!-- Add Evidence Modal -->
<div id="add-evidence-modal" class="modal">
    <div class="modal-content">
        <h3>Add New Evidence</h3>
        <form id="add-evidence-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="evidence-type">Evidence Type *</label>
                <select id="evidence-type" required>
                    <option value="">Select Type</option>
                    <option value="photo">Photo</option>
                    <option value="document">Document</option>
                    <option value="audio">Audio Recording</option>
                    <option value="video">Video</option>
                    <option value="note">Written Note</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="evidence-title">Title/Description *</label>
                <input type="text" id="evidence-title" placeholder="Brief description of evidence" required>
            </div>

            <div class="form-group">
                <label for="evidence-description">Detailed Description</label>
                <textarea id="evidence-description" placeholder="Additional details about this evidence..." rows="3"></textarea>
            </div>

            <div class="form-group">
                <label for="evidence-notes">Personal Notes</label>
                <textarea id="evidence-notes" placeholder="Your personal observations, feelings, or context..." rows="3"></textarea>
            </div>

            <div class="form-group">
                <label for="evidence-incident-date">Incident Date *</label>
                <input type="datetime-local" id="evidence-incident-date" required>
            </div>

            <div class="form-group">
                <label for="evidence-location">Location (Optional)</label>
                <input type="text" id="evidence-location" placeholder="Where did this happen?">
            </div>

            <div class="form-group">
                <label for="evidence-tags">Tags (Optional)</label>
                <input type="text" id="evidence-tags" placeholder="e.g., verbal-abuse, physical, threat">
                <small>Separate tags with commas</small>
            </div>

            <div class="form-group">
                <label>File Attachment (Optional)</label>
                <div class="file-upload" id="file-upload-area">
                    <input type="file" id="evidence-file" class="hidden-input" 
                           accept="image/*,audio/*,video/*,.pdf,.doc,.docx,.txt">
                    <div class="upload-placeholder">
                        <span class="upload-icon">üìé</span>
                        <p>Click to upload file or drag & drop</p>
                        <small>Max file size: 10MB. Supported: Images, PDF, DOC, Audio, Video</small>
                    </div>
                    <div class="file-preview hidden" id="file-preview">
                        <span class="file-icon">üìÑ</span>
                        <div class="file-info">
                            <span class="file-name" id="file-name">filename.ext</span>
                            <span class="file-size" id="file-size">0 KB</span>
                        </div>
                        <button type="button" class="remove-file" id="remove-file">√ó</button>
                    </div>
                </div>
            </div>

            <div class="form-notice">
                <span class="notice-icon">üõ°Ô∏è</span>
                <p>This evidence will be stored securely and encrypted. Only you and trusted contacts (if shared) can access this information.</p>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-secondary" id="cancel-evidence">Cancel</button>
                <button type="submit" class="btn-primary" id="save-evidence">
                    <span class="btn-loading hidden" id="save-loading">‚è≥</span>
                    Save Evidence
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Evidence Detail Modal -->
<div id="evidence-detail-modal" class="modal">
    <div class="modal-content">
        <div class="evidence-detail-header">
            <h3 id="detail-title">Evidence Details</h3>
            <div class="detail-actions">
                <button class="btn-secondary" id="download-file">Download</button>
                <button class="btn-secondary" id="edit-evidence">Edit</button>
                <button class="btn-danger" id="delete-evidence">Delete</button>
            </div>
        </div>
        <div class="evidence-detail-content" id="evidence-detail-content">
            <!-- Evidence details will be loaded here -->
        </div>
    </div>
</div>
        <!-- Safe Chat Screen -->
        <div id="chat-screen" class="screen">
            <div class="screen-header">
                <h2>Safe Chat</h2>
            </div>
            <div class="screen-content">
                <div class="chat-content">
                    <div class="chat-welcome">
                        <span class="chat-icon">üí¨</span>
                        <h3>Safe & Confidential Chat</h3>
                        <p>Chat with trained GBV counselors anonymously. All conversations are encrypted and private.</p>
                        
                        <div class="chat-options">
                            <div class="chat-option" onclick="startCounselorChat()">
                                <span class="option-icon">üë©‚Äçüíº</span>
                                <div>
                                    <h4>GBV Counselor</h4>
                                    <p>Professional support and guidance</p>
                                </div>
                            </div>
                            <div class="chat-option" onclick="startLegalChat()">
                                <span class="option-icon">‚öñÔ∏è</span>
                                <div>
                                    <h4>Legal Advisor</h4>
                                    <p>Legal rights and protection orders</p>
                                </div>
                            </div>
                            <div class="chat-option" onclick="startSupportGroup()">
                                <span class="option-icon">üë•</span>
                                <div>
                                    <h4>Support Group</h4>
                                    <p>Connect with others safely</p>
                                </div>
                            </div>
                        </div>

                        <div class="chat-features">
                            <h4>Features:</h4>
                            <ul>
                                <li>‚úÖ End-to-end encryption</li>
                                <li>‚úÖ Anonymous chatting</li>
                                <li>‚úÖ 24/7 available counselors</li>
                                <li>‚úÖ Free service</li>
                                <li>‚úÖ Auto-delete option</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <nav class="app-nav">
                <div class="nav-item" data-screen="app">
                    <span class="nav-icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="nav-item active" data-screen="chat">
                    <span class="nav-icon">üí¨</span>
                    <span>Safe Chat</span>
                </div>
                <div class="nav-item" data-screen="contacts">
                    <span class="nav-icon">üë•</span>
                    <span>Contacts</span>
                </div>
                <div class="nav-item" data-screen="profile">
                    <span class="nav-icon">üë§</span>
                    <span>Profile</span>
                </div>
            </nav>
        </div>

        <!-- Profile Screen -->
        <div id="profile-screen" class="screen">
            <div class="screen-header">
                <h2>My Profile</h2>
            </div>
            <div class="screen-content">
                <div class="profile-content">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <span id="profile-avatar">U</span>
                        </div>
                        <div class="profile-info">
                            <h3 id="profile-name">User Name</h3>
                            <p id="profile-email">user@example.com</p>
                            <p id="profile-phone">+1234567890</p>
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="profile-stat">
                            <span class="stat-value" id="trusted-contacts-count">0</span>
                            <span class="stat-label">Trusted Contacts</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-value" id="alerts-sent">0</span>
                            <span class="stat-label">Alerts Sent</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-value" id="evidence-items">0</span>
                            <span class="stat-label">Evidence Items</span>
                        </div>
                    </div>

                    <div class="profile-settings">
                        <h3>Settings</h3>
                        <div class="setting-item" onclick="editProfile()">
                            <span class="setting-icon">üë§</span>
                            <span>Edit Profile</span>
                            <span class="setting-arrow">‚Ä∫</span>
                        </div>
                        <div class="setting-item" onclick="changePassword()">
                            <span class="setting-icon">üîí</span>
                            <span>Change Password</span>
                            <span class="setting-arrow">‚Ä∫</span>
                        </div>
                        <div class="setting-item" onclick="manageNotifications()">
                            <span class="setting-icon">üîî</span>
                            <span>Notifications</span>
                            <span class="setting-arrow">‚Ä∫</span>
                        </div>
                        <div class="setting-item" onclick="privacySettings()">
                            <span class="setting-icon">üõ°Ô∏è</span>
                            <span>Privacy & Security</span>
                            <span class="setting-arrow">‚Ä∫</span>
                        </div>
                    </div>

                    <div class="emergency-settings">
                        <h3>Emergency Settings</h3>
                        <div class="setting-item" onclick="manageSafeLocations()">
                            <span class="setting-icon">üìç</span>
                            <span>Safe Locations</span>
                            <span class="setting-arrow">‚Ä∫</span>
                        </div>
                        <div class="setting-item" onclick="manageEmergencyContacts()">
                            <span class="setting-icon">üë•</span>
                            <span>Emergency Contacts</span>
                            <span class="setting-arrow">‚Ä∫</span>
                        </div>
                        <div class="setting-item" onclick="setupSafeWord()">
                            <span class="setting-icon">üó£Ô∏è</span>
                            <span>Safe Word Settings</span>
                            <span class="setting-arrow">‚Ä∫</span>
                        </div>
                    </div>
                </div>
            </div>
            <nav class="app-nav">
                <div class="nav-item" data-screen="app">
                    <span class="nav-icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="nav-item" data-screen="chat">
                    <span class="nav-icon">üí¨</span>
                    <span>Safe Chat</span>
                </div>
                <div class="nav-item" data-screen="contacts">
                    <span class="nav-icon">üë•</span>
                    <span>Contacts</span>
                </div>
                <div class="nav-item active" data-screen="profile">
                    <span class="nav-icon">üë§</span>
                    <span>Profile</span>
                </div>
            </nav>
        </div>

        <!-- Add Contact Modal -->
        <div id="add-contact-modal" class="modal">
            <div class="modal-content">
                <h3>Add Trusted Contact</h3>
                <form id="add-contact-form">
                    <input type="text" id="contact-name" placeholder="Full Name" required>
                    <input type="tel" id="contact-phone" placeholder="Phone Number" required>
                    <input type="email" id="contact-email" placeholder="Email">
                    <input type="text" id="contact-relationship" placeholder="Relationship">
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancel-contact">Cancel</button>
                        <button type="submit" class="btn-primary">Add Contact</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Evidence Modal -->
        <div id="add-evidence-modal" class="modal">
            <div class="modal-content">
                <h3>Add Evidence</h3>
                <form id="add-evidence-form">
                    <label for="evidence-type">Evidence Type:</label>
                    <select id="evidence-type" required aria-label="Evidence Type">
                        <option value="">Select Evidence Type</option>
                        <option value="photo">Photo</option>
                        <option value="document">Document</option>
                        <option value="audio">Audio Recording</option>
                        <option value="note">Written Note</option>
                    </select>
                    <input type="text" id="evidence-title" placeholder="Title/Description" required>
                    <textarea id="evidence-notes" placeholder="Additional notes..." rows="3"></textarea>
                    <label for="evidence-date">Date of Evidence:</label>
                    <input type="date" id="evidence-date" placeholder="Select date" required>
                    <div class="file-upload" id="file-upload-area">
                        <label for="evidence-file">
                            <span class="upload-icon">üìé</span>
                            <p>Tap to add file (optional)</p>
                        </label>
                        <input type="file" id="evidence-file" accept="image/*,audio/*,.pdf,.doc,.docx" class="hidden-input" title="Upload evidence file" aria-label="Upload evidence file">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancel-evidence">Cancel</button>
                        <button type="submit" class="btn-primary">Save Evidence</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
    
    // API base URL - update this to match your backend server
    // 
    const API_BASE = 'http://localhost:3000/api';
    
    let socket;
    let currentUser = null;
    let countdownInterval;
    
    // DOM Elements
    const screens = {
        login: document.getElementById('login-screen'),
        register: document.getElementById('register-screen'),
        app: document.getElementById('app-screen'),
        emergency: document.getElementById('emergency-screen'),
        contacts: document.getElementById('contacts-screen'),
        safety: document.getElementById('safety-plan-screen'),
        resources: document.getElementById('resources-screen'),
        evidence: document.getElementById('evidence-screen'),
        chat: document.getElementById('chat-screen'),
        profile: document.getElementById('profile-screen')
    };
    
    // Initialize app
    // 
    document.addEventListener('DOMContentLoaded', function() {
        initializeEventListeners();
        checkExistingAuth();
    });
    
    function initializeEventListeners() {
        // Auth navigation
        // 
        document.getElementById('show-register').addEventListener('click', showRegister);
        document.getElementById('show-login').addEventListener('click', showLogin);
        
        // Forms
        
        document.getElementById('login-form').addEventListener('submit', handleLogin);
        document.getElementById('register-form').addEventListener('submit', handleRegister);
        
        // App navigation
         
        document.getElementById('logout-btn').addEventListener('click', handleLogout);
        
        // Navigation items    
         
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const screen = this.getAttribute('data-screen');
                handleNavClick(screen);
            });
        });
        
        // Emergency features
        document.getElementById('emergency-btn').addEventListener('click', showEmergencyScreen);
        document.getElementById('cancel-emergency').addEventListener('click', cancelEmergency);
        document.getElementById('send-now').addEventListener('click', sendEmergencyNow);
        
        // Contacts
        document.getElementById('add-contact-btn').addEventListener('click', showAddContactModal);
        document.getElementById('cancel-contact').addEventListener('click', hideAddContactModal);
        document.getElementById('add-contact-form').addEventListener('submit', handleAddContact);
        
        // Evidence
         
        document.getElementById('add-evidence-btn').addEventListener('click', showAddEvidenceModal);
        document.getElementById('cancel-evidence').addEventListener('click', hideAddEvidenceModal);
        document.getElementById('add-evidence-form').addEventListener('submit', handleAddEvidence);
        document.getElementById('file-upload-area').addEventListener('click', () => {
            document.getElementById('evidence-file').click();
        });

        // Quick actions
        document.querySelectorAll('.action-card').forEach(card => {
            card.addEventListener('click', function() {
                const action = this.getAttribute('data-action');
                handleQuickAction(action);
            });
        });

        // Fake mode
            document.getElementById('fake-mode-btn').addEventListener('click', toggleFakeMode);
        }
        
        function checkExistingAuth() {
            const token = localStorage.getItem('gbv_token');
            const user = localStorage.getItem('gbv_user');
            
            if (token && user) {
                currentUser = JSON.parse(user);
                showScreen('app');
                initializeSocket();
                loadUserData();
            } else {
                showScreen('login');
            }
        }

        function showScreen(screenName) {
            Object.values(screens).forEach(screen => screen.classList.remove('active'));
            if (screens[screenName]) {
                screens[screenName].classList.add('active');
            }
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-screen') === screenName) {
                    item.classList.add('active');
                }
            });
        }

        function handleNavClick(screenName) {
            showScreen(screenName);
            
            // Load specific screen data
            switch(screenName) {
                case 'contacts':
                    loadContacts();
                    break;
                case 'evidence':
                    loadEvidence();
                    break;
                case 'profile':
                    loadProfile();
                    break;
                case 'app':
                    loadRecentAlerts();
                    break;
            }
        }

        function handleQuickAction(action) {
            switch(action) {
                case 'contacts':
                    showScreen('contacts');
                    loadContacts();
                    break;
                case 'safety-plan':
                    showScreen('safety');
                    break;
                case 'resources':
                    showScreen('resources');
                    break;
                case 'evidence':
                    showScreen('evidence');
                    loadEvidence();
                    break;
            }
        }

        function showRegister(e) {
            e.preventDefault();
            showScreen('register');
        }

        function showLogin(e) {
            e.preventDefault();
            showScreen('login');
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            console.log("üü° Attempting login with:", { email, password }); // 1Ô∏è‚É£ Debug: log credentials

            try {
                const res = await fetch('http://localhost:3000/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
                });

                console.log("üü¢ Response received:", res); // 2Ô∏è‚É£ Debug: response object

                const data = await res.json();
                console.log("üü¢ Response JSON:", data); // 3Ô∏è‚É£ Debug: JSON body

                if (res.ok) {
                // Save token and user info in localStorage
                localStorage.setItem('gbv_token', data.token);
                localStorage.setItem('gbv_user', JSON.stringify(data.user));

                console.log("‚úÖ Login successful! Token:", data.token);
                showScreen('app');
                initializeSocket();
                loadUserData();
                showAlert('Login successful!');
                } else {
                console.error("‚ùå Login failed:", data.message);
                alert("Login failed: " + data.message);
                }
            } catch (err) {
                console.error("üî• Connection error during login:", err.message);
                alert('Error: ' + err.message);
            }
            /*try {
                // Mock login for demo - in real app, this would call your backend
                if (email && password) {
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem('gbv_token', data.token);
                    localStorage.setItem('gbv_user', JSON.stringify(data.user));
                    showScreen('app');
                    initializeSocket();
                    loadUserData();
                    showAlert('Login successful!');
                } else {
                    alert(data.message || 'Login failed');
                }
            }

            } catch (error) {
                alert('Login error: ' + error.message);
            }*/
        }
        async function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const phone = document.getElementById('register-phone').value;
            console.log("üü° Attempting to register user:", { name, email, phone }); // 1Ô∏è‚É£ Check that inputs exist

            try {
                const res = await fetch('http://localhost:10000/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, email, password, phone })
                });

                console.log("üü¢ Response received:", res); // 2Ô∏è‚É£ Log response object
                
                const data = await res.json();
                 console.log("üü¢ Response JSON:", data); // 3Ô∏è‚É£ Log parsed JSON

                if (res.ok) {
                localStorage.setItem('gbv_token', data.token);
                localStorage.setItem('gbv_user', JSON.stringify(data.user));

                 console.log("‚úÖ Registration successful! Token:", data.token); // 4Ô∏è‚É£ Confirm token
                showScreen('app');
                showAlert('Registration successful!');
                } else {
                alert(data.message);
                }                
                // Mock registration for demo
                /*if (name && email && password && phone) {
                    const mockUser = {
                        id: 'user_' + Date.now(),
                        name: name,
                        email: email,
                        phone: phone
                    };
                    
                    //localStorage.setItem('gbv_token', 'mock_jwt_token_' + Date.now());
                    //localStorage.setItem('gbv_user', JSON.stringify(mockUser));
                    //currentUser = mockUser;
                    //showScreen('app');
                    //initializeSocket();
                    //showAlert('Registration successful!');
                } else {
                    alert('Please fill all fields');
                }
                    */
            } catch (error) {
                alert('Registration error: ' + error.message);
            }
        }
         function handleLogout() {
            localStorage.removeItem('gbv_token');
            localStorage.removeItem('gbv_user');
            currentUser = null;
            if (socket) socket.disconnect();
            showScreen('login');
        }

        function initializeSocket() {
            // Mock socket initialization for demo
            console.log('Socket initialized for user:', currentUser?.name);
        }

        function showAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                z-index: 1000;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                max-width: 300px;
            `;
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                document.body.removeChild(alertDiv);
            }, 5000);
        }

        // Emergency Functions
        function showEmergencyScreen() {
            showScreen('emergency');
            startCountdown();
            //getCurrentLocation();
            loadEmergencyContacts();
        }

        function startCountdown() {
            let seconds = 5;
            const countdownElement = document.getElementById('countdown');
            const countdownSeconds = document.getElementById('countdown-seconds');
            const messageElement = document.getElementById('help-message'); // üëà make sure you have this element in HTML

            countdownElement.textContent = seconds;
            countdownSeconds.textContent = seconds;

            countdownInterval = setInterval(() => {
                seconds--;
                countdownElement.textContent = seconds;
                countdownSeconds.textContent = seconds;

                if (seconds <= 0) {
                    // üõë stop countdown
                    clearInterval(countdownInterval)

                    countdownElement.textContent = "0";
                    countdownSeconds.textContent = "0";

                    if(messageElement) {
                       messageElement.innerHTML = "<h2>üö® Help is on the way!</h2>";
                       countdownSeconds.parentElement.style.display = 'none';
                       sendEmergencyAlert();
                    }
                    
                }
            }, 1000);
        }

        function cancelEmergency() {
            clearInterval(countdownInterval);
            showScreen('app');
            showAlert('Emergency cancelled');
        }

        function sendEmergencyNow() {
            clearInterval(countdownInterval);
            sendEmergencyAlert();
        }

        // Enhanced Emergency Alert System
        async function sendEmergencyAlert() {
            const location = document.getElementById('location-text').textContent;
            
            try {
                const token = localStorage.getItem('gbv_token');
                const response = await fetch(`${API_BASE}/alerts/emergency`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        location: location,
                        message: 'Emergency assistance needed'
                    })
                });
                console.log('‚úÖ Alert created Location:', location); // Debug log

                if (response.ok) {
                    const alertData = await response.json();
                    console.log('‚úÖ Alert created successfully:', alertData);
                    
                    showAlert('üö® Emergency alert sent to your trusted contacts!');
                    //showScreen('app');
                    loadRecentAlerts();
                } else {
                    throw new Error('Failed to send emergency alert');
                }
            } catch (error) {
                console.error('‚ùå Error sending alert:', error);
                alert('Error sending alert: ' + error.message);
            }
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        document.getElementById('location-text').textContent = 
                            `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
                    },
                    (error) => {
                        document.getElementById('location-text').textContent = 
                            'Location access denied. Using last known location.';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            } else {
                document.getElementById('location-text').textContent = 
                    'Geolocation not supported by browser';
            }
        }

        // Contacts Functions
        async function loadEmergencyContacts() {
            try {
                const contacts = JSON.parse(localStorage.getItem('gbv_contacts') || '[]');
                const contactsContainer = document.getElementById('emergency-contacts');
                if (contacts.length > 0) {
                    contactsContainer.innerHTML = contacts.map(contact => 
                        `<div class="contact-item">
                            <span>${contact.name}</span>
                            <span>${contact.relationship || 'Trusted Contact'}</span>
                        </div>`
                    ).join('');
                } else {
                    contactsContainer.innerHTML = '<p>No trusted contacts added yet.</p>';
                }
            } catch (error) {
                console.error('Error loading contacts:', error);
                document.getElementById('emergency-contacts').innerHTML = '<p>Error loading contacts</p>';
            }
        }

        function showAddContactModal() {
            document.getElementById('add-contact-modal').classList.add('active');
        }

        function hideAddContactModal() {
            document.getElementById('add-contact-modal').classList.remove('active');
            document.getElementById('add-contact-form').reset();
        }
        
        // Evidence Functions
        // Enhanced evidence submission with better error handling
        async function handleAddEvidence(e) {
            e.preventDefault();
            console.log('üìÅ Starting evidence submission...');

            const submitBtn = document.getElementById('save-evidence');
            const loadingSpinner = document.getElementById('save-loading');
            
            try {
                if (submitBtn) submitBtn.disabled = true;
                if (loadingSpinner) loadingSpinner.classList.remove('hidden');
                
                // Collect input data
                // 
                const type = document.getElementById('evidence-type').value;
                const title = document.getElementById('evidence-title').value;
                const description = document.getElementById('evidence-description').value;
                const notes = document.getElementById('evidence-notes').value;
                const incidentDate = document.getElementById('evidence-incident-date').value;
                const location = document.getElementById('evidence-location').value;
                const tags = document.getElementById('evidence-tags').value;
                
                if (!type || !title || !incidentDate) {
                    throw new Error('Please fill in all required fields (Type, Title, and Date)');
                }
                
                const fileInput = document.getElementById('evidence-file');
                const formData = new FormData();
                
                formData.append('type', type);
                formData.append('title', title);
                formData.append('description', description || title);
                formData.append('notes', notes);
                formData.append('incidentDate', incidentDate);
                formData.append('location', location);
                formData.append('tags', tags);
                
                if (fileInput && fileInput.files.length > 0) {
                    formData.append('file', fileInput.files[0]);
                    console.log('üìÅ Attached file:', fileInput.files[0].name);
                }
                
                const token = localStorage.getItem('gbv_token');
                if (!token) throw new Error('Authentication required. Please log in again.');
                
                console.log('üì° Sending evidence to server...');
                
                const response = await fetch(`${API_BASE}/evidence`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: 'Unknown server error' }));
                    throw new Error(errorData.message || `Server error: ${response.status}`);
                }
                const result = await response.json();
                console.log('‚úÖ Evidence saved successfully:', result);
                
                hideAddEvidenceModal();
                showAlert('Evidence saved securely! üîí');
                
                setTimeout(() => loadEvidence(), 1000);
            } catch (error) {
                console.error('‚ùå Error saving evidence:', error);
                showAlert(`Error: ${error.message}`, 'error');
                
                if (error.message.includes('Authentication')) {
                    setTimeout(() => handleLogout(), 2000);
                }
            } finally {
                if (submitBtn) submitBtn.disabled = false;
                if (loadingSpinner) loadingSpinner.classList.add('hidden');
            }
        }
        // Enhanced Trusted Contact Management
        async function handleAddContact(e) {
            e.preventDefault();
            const name = document.getElementById('contact-name').value;
            const phone = document.getElementById('contact-phone').value;
            const email = document.getElementById('contact-email').value;
            const relationship = document.getElementById('contact-relationship').value;

            try {
                const token = localStorage.getItem('gbv_token');
                const response = await fetch(`${API_BASE}/contacts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ name, phone, email, relationship })
                });

                if (response.ok) {
                    const data = await response.json();
                    hideAddContactModal();
                    showAlert(`Contact ${name} added successfully!`);
                    loadContacts();
                    
                    if (data.tempPassword) {
                        alert(`Temporary password for ${name}: ${data.tempPassword}\n\nShare this with your contact so they can login to the trusted contact app.`);
                    }
                } else {
                    const error = await response.json();
                    alert('Failed to add contact: ' + (error.message || 'Unknown error'));
                }
            } catch (error) {
                alert('Error adding contact: ' + error.message);
            }
        }
        async function loadContacts() {
            const contactsList = document.getElementById('contacts-list');
            const token = localStorage.getItem('gbv_token'); // ü™™ JWT token stored on login
              try {
                const response = await fetch('http://localhost:3000/api/contacts', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                     }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Server returned ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const contacts = data.contacts || [];
                    console.log('üì° Contacts loaded from API:', contacts);
                    // üíæ 2Ô∏è‚É£ Save a copy locally for offline access

                    
                    localStorage.setItem('gbv_contacts', JSON.stringify(contacts));
                    
                    // üñºÔ∏è 3Ô∏è‚É£ Render contacts on the page

                    if (contacts.length > 0) {
                        contactsList.innerHTML = contacts.map(contact =>
                        `<div class="contact-item">
                            <div class="contact-info">
                                <div class="contact-name">${contact.name}</div>
                                <div class="contact-details">${contact.phone} ‚Ä¢ ${contact.email}</div>
                                <div class="contact-relationship">${contact.relationship || 'Trusted Contact'}</div>
                                </div>
                                <button class="btn-secondary" onclick="deleteContact('${contact._id}')">Remove</button>
                                </div>`
                            ).join('');
                        } else {
                            contactsList.innerHTML = `
                            <div class="empty-state">
                                <span class="empty-icon">üë•</span>
                                <h3>No Trusted Contacts</h3>
                                <p>Add trusted contacts who will be notified in emergencies</p>
                                <button class="btn-primary" onclick="showAddContactModal()">Add First Contact</button>
                                </div>
                                `;
                            }
                        } catch (error) {
                            console.error('‚ùå Error loading contacts:', error);
                            
                            // üß≠ 4Ô∏è‚É£ Fallback: Load local data if server fails
                            const localContacts = JSON.parse(localStorage.getItem('gbv_contacts') || '[]');
                            
                            if (localContacts.length > 0) {
                                console.warn('‚ö†Ô∏è Using cached contacts from localStorage');
                                contactsList.innerHTML = localContacts.map(contact =>
                                `<div class="contact-item">
                                    <div class="contact-info">
                                        <div class="contact-name">${contact.name}</div>
                                        <div class="contact-details">${contact.phone} ‚Ä¢ ${contact.email}</div>
                                        <div class="contact-relationship">${contact.relationship || 'Trusted Contact'}</div>
                                        </div>
                                        <button class="btn-secondary" onclick="deleteContact('${contact.id || contact._id}')">Remove</button>
                                        </div>`
                                    ).join('');
                                } else {
                                    contactsList.innerHTML = `
                                    <div class="empty-state">
                                        <span class="empty-icon">üíæ</span>
                                        <h3>Error loading contacts</h3>
                                        <p>Try refreshing the page or checking your connection</p>
                                        </div>
                                        `;
                                    }
                                }
                            }

                            // üßπ Delete contact from both localStorage and backend
                         
                            async function deleteContact(contactId) {
                                
                                if (confirm('Are you sure you want to remove this trusted contact?')) {
                                    
                                    try {
                                        console.log('üß© Deleting contact with ID:', contactId);
                                        
                                        // Get token for authentication
                                        // 
                                        const token = localStorage.getItem('gbv_token');
                                        
                                        if (!token) {
                                            
                                            showAlert('‚ö†Ô∏è Please log in again ‚Äî authentication token missing.');
                                            
                                            return;
                                        }
                                        
                                        // üõ∞Ô∏è Delete from backen
                                        // 
                                        
                                        const response = await fetch(`http://localhost:3000/api/contacts/${contactId}`, {
                                            method: 'DELETE',
                                            headers: {
                                                'Authorization': `Bearer ${token}`,
                                                'Content-Type': 'application/json'
                                            }
                                        });
                                        
                                        if (!response.ok) {
                                            
                                            const errorText = await response.text();
                                            console.error('üö® Backend delete failed:', errorText);
                                            
                                            showAlert('‚ùå Failed to remove contact from server.');
                                            return;
                                        }
                                        
                                        console.log('‚úÖ Contact deleted from backend.');
                                        
                                        // üíæ Delete from localStorage
                                        // 
                                        
                                        const contacts = JSON.parse(localStorage.getItem('gbv_contacts') || '[]');
                                        const updatedContacts = contacts.filter(contact => contact.id !== contactId);
                                        
                                        localStorage.setItem('gbv_contacts', JSON.stringify(updatedContacts));
                                        
                                        console.log('üßπ Contact removed locally.');
                                        showAlert('‚úÖ Contact removed successfully.');
                                        
                                        loadContacts();
                                    
                                    } catch (error) {
                                        console.error('üí• Error deleting contact:', error);
                                        showAlert('‚ùå Error removing contact: ' + error.message);
                                    }
                                }
                            }
                            // Enhanced Evidence Vault Functions
                            // 
                            function showAddEvidenceModal() {
                                console.log('üìÅ Opening add evidence modal');
                                document.getElementById('add-evidence-modal').classList.add('active');
                                
                                // Set current date and time as default
                                // Set current date and time as default
                                const now = new Date();
                                const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
                                document.getElementById('evidence-incident-date').value = localDateTime;
                            }
                            
                            function hideAddEvidenceModal() {
                                document.getElementById('add-evidence-modal').classList.remove('active');
                                document.getElementById('add-evidence-form').reset();
                                
                                // Reset file preview
                                // 
                                const filePreview = document.getElementById('file-preview');
                                const uploadPlaceholder = document.querySelector('.upload-placeholder');
                                
                                if (filePreview) {
                                    filePreview.classList.add('hidden');
                                }
                                
                                if (uploadPlaceholder) {
                                    uploadPlaceholder.classList.remove('hidden');
                                }
                            }
                            

// Enhanced file upload handling
function setupFileUpload() {
    const fileInput = document.getElementById('evidence-file');
    const uploadArea = document.getElementById('file-upload-area');
    const filePreview = document.getElementById('file-preview');
    const fileName = document.getElementById('file-name');
    const fileSize = document.getElementById('file-size');
    const removeFile = document.getElementById('remove-file');

    if (!fileInput || !uploadArea) return;

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            updateFilePreview();
        }
    });

    // File input change
    fileInput.addEventListener('change', updateFilePreview);

    // Remove file
    if (removeFile) {
        removeFile.addEventListener('click', (e) => {
            e.preventDefault();
            fileInput.value = '';
            if (filePreview) filePreview.classList.add('hidden');
            if (uploadArea.querySelector('.upload-placeholder')) {
                uploadArea.querySelector('.upload-placeholder').classList.remove('hidden');
            }
        });
    }

    // Click to upload
    uploadArea.addEventListener('click', () => fileInput.click());
}

function updateFilePreview() {
    const fileInput = document.getElementById('evidence-file');
    const filePreview = document.getElementById('file-preview');
    const fileName = document.getElementById('file-name');
    const fileSize = document.getElementById('file-size');
    const uploadPlaceholder = document.querySelector('.upload-placeholder');

    if (!fileInput || !filePreview || !uploadPlaceholder) return;

    if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        if (fileName) fileName.textContent = file.name;
        if (fileSize) fileSize.textContent = formatFileSize(file.size);
        
        // Update icon based on file type
        const fileIcon = filePreview.querySelector('.file-icon');
        if (fileIcon) {
            fileIcon.textContent = getFileIcon(file.type);
        }
        
        uploadPlaceholder.classList.add('hidden');
        filePreview.classList.remove('hidden');
    }
}

function getFileIcon(mimeType) {
    if (mimeType.startsWith('image/')) return 'üñºÔ∏è';
    if (mimeType.startsWith('audio/')) return 'üéµ';
    if (mimeType.startsWith('video/')) return 'üé•';
    if (mimeType.includes('pdf')) return 'üìï';
    if (mimeType.includes('document') || mimeType.includes('word')) return 'üìÑ';
    return 'üìé';
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}


// Enhanced evidence loading
async function loadEvidence() {
    console.log('üìÅ Loading evidence...');
    
    try {
        const token = localStorage.getItem('gbv_token');
        if (!token) {
            console.log('‚ùå No authentication token');
            return;
        }

        const response = await fetch(`${API_BASE}/evidence`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        
        if (data.success && data.evidence) {
            displayEvidenceList(data.evidence);
            updateEvidenceStats(data);
        } else {
            throw new Error(data.message || 'Invalid response format');
        }

    } catch (error) {
        console.error('‚ùå Error loading evidence:', error);
        displayEvidenceError('Failed to load evidence: ' + error.message);
    }
}

function displayEvidenceList(evidence) {
    const evidenceList = document.getElementById('evidence-list');
    const totalEvidence = document.getElementById('total-evidence');
    const recentItems = document.getElementById('recent-items');

    if (!evidenceList) return;

    if (evidence.length === 0) {
        evidenceList.innerHTML = `
            <div class="empty-state">
                <span class="empty-icon">üìÅ</span>
                <h3>No Evidence Stored</h3>
                <p>Add photos, documents, or notes as evidence</p>
                <button class="btn-primary" onclick="showAddEvidenceModal()">Add First Evidence</button>
            </div>
        `;
        return;
    }

    // Update stats
    if (totalEvidence) {
        totalEvidence.textContent = evidence.length;
    }
    if (recentItems) {
        const recentCount = evidence.filter(item => {
            const itemDate = new Date(item.createdAt);
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            return itemDate > monthAgo;
        }).length;
        recentItems.textContent = recentCount;
    }

    // Display evidence items
    evidenceList.innerHTML = evidence.map(item => `
        <div class="evidence-item" data-id="${item._id || item.id}">
            <div class="evidence-item-header">
                <div class="evidence-type-badge evidence-type-${item.type}">
                    ${getEvidenceTypeIcon(item.type)} ${item.type}
                </div>
                <div class="evidence-date">
                    ${new Date(item.date).toLocaleDateString()}
                </div>
            </div>
            <div class="evidence-item-content">
                <h4 class="evidence-title">${item.title}</h4>
                <p class="evidence-description">${item.description || 'No description'}</p>
                ${item.notes ? `<p class="evidence-notes">${item.notes}</p>` : ''}
                ${item.location ? `<p class="evidence-location">üìç ${item.location}</p>` : ''}
                ${item.fileName ? `<p class="evidence-file">üìé ${item.fileName}</p>` : ''}
            </div>
            <div class="evidence-item-footer">
                <div class="evidence-tags">
                    ${item.tags && item.tags.length > 0 ? 
                      item.tags.map(tag => `<span class="evidence-tag">${tag}</span>`).join('') : 
                      '<span class="no-tags">No tags</span>'
                    }
                </div>
                <button class="btn-secondary btn-sm" onclick="viewEvidenceDetail('${item._id || item.id}')">
                    View Details
                </button>
            </div>
        </div>
    `).join('');
}

function getEvidenceTypeIcon(type) {
    const icons = {
        'photo': 'üñºÔ∏è',
        'document': 'üìÑ',
        'audio': 'üéµ',
        'video': 'üé•',
        'note': 'üìù',
        'other': 'üìé'
    };
    return icons[type] || 'üìé';
}

function displayEvidenceError(message) {
    const evidenceList = document.getElementById('evidence-list');
    if (evidenceList) {
        evidenceList.innerHTML = `
            <div class="error-state">
                <span class="error-icon">‚ö†Ô∏è</span>
                <h3>Error Loading Evidence</h3>
                <p>${message}</p>
                <button class="btn-primary" onclick="loadEvidence()">Try Again</button>
            </div>
        `;
    }
}

function updateEvidenceStats(data) {
    // Update any additional stats if needed
    console.log('üìä Evidence stats updated:', data);
}

// Initialize evidence functionality
function initializeEvidenceVault() {
    console.log('üîß Initializing evidence vault...');
    
    // Set up event listeners
    const addEvidenceBtn = document.getElementById('add-evidence-btn');
    const cancelEvidenceBtn = document.getElementById('cancel-evidence');
    const addEvidenceForm = document.getElementById('add-evidence-form');
    
    if (addEvidenceBtn) {
        addEvidenceBtn.addEventListener('click', showAddEvidenceModal);
    }
    
    if (cancelEvidenceBtn) {
        cancelEvidenceBtn.addEventListener('click', hideAddEvidenceModal);
    }
    
    if (addEvidenceForm) {
        addEvidenceForm.addEventListener('submit', handleAddEvidence);
    }
    
    // Set up file upload
    setupFileUpload();
    
    // Load initial evidence
    setTimeout(() => {
        loadEvidence();
    }, 1000);
}

// Make functions globally available
window.showAddEvidenceModal = showAddEvidenceModal;
window.hideAddEvidenceModal = hideAddEvidenceModal;
window.handleAddEvidence = handleAddEvidence;
window.loadEvidence = loadEvidence;

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initializeEvidenceVault();
});

        // Safety Plan Functions
        function addSafeLocation() {
            const name = prompt('Enter safe location name:');
            const address = prompt('Enter address:');
            if (name && address) {
                showAlert(`Safe location "${name}" added`);
            }
        }

        function callNumber(number) {
            alert(`Calling ${number}...\n\nIn a real app, this would dial the number.`);
            // window.open(`tel:${number}`, '_self');
        }

        // Resources Functions
        function viewShelters() {
            alert('Showing safe houses and shelters in your area...');
        }

        function viewLegalAid() {
            alert('Connecting to legal aid services...');
        }

        function openResource(resource) {
            const resources = {
                'safety-planning': 'Safety Planning Guide opened...',
                'legal-rights': 'Legal Rights information opened...',
                'counseling': 'Counseling Services information opened...'
            };
            alert(resources[resource] || 'Resource opened...');
        }

        // Safe Chat Functions
        function startCounselorChat() {
            alert('Connecting to GBV counselor...\n\nThis would open a secure chat interface.');
        }

        function startLegalChat() {
            alert('Connecting to legal advisor...\n\nThis would open a secure chat interface.');
        }

        function startSupportGroup() {
            alert('Joining support group chat...\n\nThis would connect you with other survivors safely.');
        }

        // Profile Functions
        function loadProfile() {
            if (currentUser) {
                document.getElementById('profile-name').textContent = currentUser.name;
                document.getElementById('profile-email').textContent = currentUser.email;
                document.getElementById('profile-phone').textContent = currentUser.phone;
                document.getElementById('profile-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
                
                // Load stats
                const contacts = JSON.parse(localStorage.getItem('gbv_contacts') || '[]');
                const evidence = JSON.parse(localStorage.getItem('gbv_evidence') || '[]');
                const alerts = JSON.parse(localStorage.getItem('gbv_alerts') || '[]');
                
                document.getElementById('trusted-contacts-count').textContent = contacts.length;
                document.getElementById('evidence-items').textContent = evidence.length;
                document.getElementById('alerts-sent').textContent = alerts.length;
            }
        }

        function editProfile() {
            alert('Edit profile feature would open here.');
        }

        function changePassword() {
            alert('Change password feature would open here.');
        }

        function manageNotifications() {
            alert('Notification settings would open here.');
        }

        function privacySettings() {
            alert('Privacy and security settings would open here.');
        }

        function manageSafeLocations() {
            showScreen('safety');
        }

        function manageEmergencyContacts() {
            showScreen('contacts');
        }

        function setupSafeWord() {
            const safeWord = prompt('Enter your safe word (used when speaking under duress):', 'bluebird');
            if (safeWord) {
                localStorage.setItem('gbv_safe_word', safeWord);
                showAlert(`Safe word set to: ${safeWord}`);
            }
        }

        // Recent Alerts
        async function loadRecentAlerts() {
            try {
                const alerts = JSON.parse(localStorage.getItem('gbv_alerts') || '[]');
                const alertsList = document.getElementById('alerts-list');
                if (alerts.length > 0) {
                    alertsList.innerHTML = alerts.slice(0, 3).map(alert => `
                        <div class="alert-item ${alert.status === 'resolved' ? 'resolved' : ''}">
                            <div class="alert-time">${new Date(alert.createdAt).toLocaleString()}</div>
                            <div>${alert.message}</div>
                            <span class="alert-status ${alert.status === 'active' ? 'status-active' : 'status-resolved'}">
                                ${alert.status}
                            </span>
                        </div>
                    `).join('');
                } else {
                    alertsList.innerHTML = '<p style="text-align: center; color: #666;">No recent alerts</p>';
                }
            } catch (error) {
                console.error('Error loading alerts:', error);
                document.getElementById('alerts-list').innerHTML = '<p style="text-align: center; color: red;">Error loading alerts</p>';
            }
        }

        // Load user data
        async function loadUserData() {
            if (currentUser) {
                document.getElementById('user-name').textContent = currentUser.name;
                loadContacts();
                loadEvidence();
                loadRecentAlerts();
                loadProfile();
            }
        }

        // Fake Mode
        function toggleFakeMode() {
            const btn = document.getElementById('fake-mode-btn');
            if (btn.textContent === 'Activate Calendar Mode') {
                document.body.innerHTML = `
                    <div style="padding: 2rem; text-align: center; background: white; min-height: 100vh; font-family: Arial, sans-serif;">
                        <h2 style="color: #8B008B; margin-bottom: 2rem;">üìÖ Calendar - October 2023</h2>
                        <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin: 2rem 0;">
                            <div style="font-weight: bold; padding: 10px; background: #f0f0f0;">Sun</div>
                            <div style="font-weight: bold; padding: 10px; background: #f0f0f0;">Mon</div>
                            <div style="font-weight: bold; padding: 10px; background: #f0f0f0;">Tue</div>
                            <div style="font-weight: bold; padding: 10px; background: #f0f0f0;">Wed</div>
                            <div style="font-weight: bold; padding: 10px; background: #f0f0f0;">Thu</div>
                            <div style="font-weight: bold; padding: 10px; background: #f0f0f0;">Fri</div>
                            <div style="font-weight: bold; padding: 10px; background: #f0f0f0;">Sat</div>
                            ${Array.from({length: 35}, (_, i) => 
                                `<div style="padding: 12px; border: 1px solid #eee; border-radius: 5px; cursor: pointer; 
                                    background: ${i >= 1 && i < 32 ? '#f9f9f9' : '#f5f5f5'}; 
                                    color: ${i >= 1 && i < 32 ? '#333' : '#ccc'};">
                                 ${i >= 1 && i < 32 ? i : ''}
                                 </div>`
                            ).join('')}
                        </div>
                        <p style="margin-top: 2rem; font-size: 0.9rem; color: #666;">
                            üìÖ Regular Calendar App<br>
                            <small>Tap and hold any date for 3 seconds to access safety features</small>
                        </p>
                        <button onclick="location.reload()" style="margin-top: 2rem; padding: 1rem 2rem; background: #8B008B; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Return to Safety App
                        </button>
                    </div>
                `;
            }
        }

        // Make functions globally available
        window.deleteContact = deleteContact;
        window.addSafeLocation = addSafeLocation;
        window.callNumber = callNumber;
        window.viewShelters = viewShelters;
        window.viewLegalAid = viewLegalAid;
        window.openResource = openResource;
        window.startCounselorChat = startCounselorChat;
        window.startLegalChat = startLegalChat;
        window.startSupportGroup = startSupportGroup;
        window.editProfile = editProfile;
        window.changePassword = changePassword;
        window.manageNotifications = manageNotifications;
        window.privacySettings = privacySettings;
        window.manageSafeLocations = manageSafeLocations;
        window.manageEmergencyContacts = manageEmergencyContacts;
        window.setupSafeWord = setupSafeWord;
        window.showAddEvidenceModal = showAddEvidenceModal;
    </script>

</body>
</html>